<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generatore Orario Scolastico</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  input, select, button { margin: 5px; }
  table { border-collapse: collapse; margin-top: 20px; }
  td, th { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #eee; }
</style>
</head>
<body>

<h2>Generatore Orario Scolastico</h2>

<h3>Inserisci materie e ore settimanali</h3>
<div id="materie-container"></div>
<button onclick="aggiungiMateria()">Aggiungi materia</button>
<br><br>

<h3>Impostazioni orario</h3>
<select id="impostazioni">
  <option value="equilibrato">Equilibrato</option>
  <option value="inizioImpegnativo">Inizio settimana più impegnativo</option>
  <option value="inizioSoft">Inizio settimana più soft</option>
</select>
<br><br>

<button onclick="generaOrario()">Genera Orario</button>

<h3>Orario Generato</h3>
<table id="orario-table">
  <thead>
    <tr>
      <th>Giorno</th>
      <th>Ora 1</th>
      <th>Ora 2</th>
      <th>Ora 3</th>
      <th>Ora 4</th>
      <th>Ora 5</th>
      <th>Ora 6</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let materieCount = 0;
function aggiungiMateria() {
  if (materieCount >= 10) return alert("Massimo 10 materie");
  materieCount++;
  const container = document.getElementById("materie-container");
  const div = document.createElement("div");
  div.innerHTML = `Materia ${materieCount}: <input type="text" id="materia-${materieCount}" placeholder="Nome">
                   Ore settimanali: <input type="number" id="ore-${materieCount}" min="1" max="10">`;
  container.appendChild(div);
}

function generaOrario() {
  const materie = [];
  for (let i = 1; i <= materieCount; i++) {
    const nome = document.getElementById(`materia-${i}`).value.trim();
    const ore = parseInt(document.getElementById(`ore-${i}`).value);
    if (!nome || !ore) return alert("Compila tutte le materie e le ore");
    materie.push({nome, ore});
  }

  const impostazione = document.getElementById("impostazioni").value;

  // Generazione semplice dell'orario
  const giorni = ["Lunedì","Martedì","Mercoledì","Giovedì","Venerdì"];
  const orario = giorni.map(giorno => []);
  
  // Cloniamo le materie per gestire le ore residue
  let oreResidue = materie.map(m => ({...m}));

  function getRandomMateria(oreResidue, giorno) {
    let disponibili = oreResidue.filter(m => m.ore > 0);
    if (!disponibili.length) return null;

    // Evita più di 2 ore al giorno della stessa materia tranne EF
    let counts = {};
    giorno.forEach(m => counts[m] = (counts[m]||0)+1);

    disponibili = disponibili.filter(m => (counts[m.nome]||0) < 2 || m.nome === "Educazione Fisica");
    if (!disponibili.length) return null;

    return disponibili[Math.floor(Math.random() * disponibili.length)];
  }

  giorni.forEach((giorno, i) => {
    let giornoArray = [];
    let oreGiornaliere = 6;
    
    if (impostazione === "inizioImpegnativo") oreGiornaliere = i < 2 ? 6 : 4;
    if (impostazione === "inizioSoft") oreGiornaliere = i < 2 ? 4 : 6;

    while(giornoArray.length < oreGiornaliere) {
      let m = getRandomMateria(oreResidue, giornoArray);
      if (!m) break;

      // Gestione EF 2 ore consecutive
      if (m.nome === "Educazione Fisica" && m.ore >= 2 && giornoArray.length <= oreGiornaliere-2) {
        giornoArray.push(m.nome, m.nome);
        m.ore -= 2;
      } else {
        giornoArray.push(m.nome);
        m.ore -= 1;
      }
    }
    orario[i] = giornoArray;
  });

  // Visualizzazione
  const tbody = document.getElementById("orario-table").querySelector("tbody");
  tbody.innerHTML = "";
  orario.forEach((giornoArray, i) => {
    const tr = document.createElement("tr");
    const giornoCell = document.createElement("td");
    giornoCell.textContent = giorni[i];
    tr.appendChild(giornoCell);
    for(let j=0;j<6;j++){
      const td = document.createElement("td");
      td.textContent = giornoArray[j] || "";
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  });
}
</script>

</body>
</html>


